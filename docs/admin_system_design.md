# 카페 추천 시스템 - 관리자 시스템 설계

## 1. 개요

관리자 시스템은 카페 추천 시스템의 메뉴 관리, 주문 처리, 매출 통계 등을 관리할 수 있는 기능을 제공합니다. 이 문서는 관리자 시스템 구현에 필요한 기술 스택과 설계도를 제공합니다.

## 2. 기술 스택

### 백엔드
- **FastAPI**: 고성능 Python 웹 프레임워크
- **SQLAlchemy**: ORM(Object-Relational Mapping) 라이브러리
- **Pydantic**: 데이터 검증 및 설정 관리
- **JWT(JSON Web Tokens)**: 인증 및 권한 관리
- **Passlib**: 비밀번호 해싱 및 검증
- **Python-jose**: JWT 토큰 생성 및 검증
- **Pytest**: 테스트 프레임워크

### 프론트엔드
- **Next.js**: React 기반 프레임워크
- **React**: UI 라이브러리
- **TypeScript**: 정적 타입 지원
- **Tailwind CSS**: 스타일링
- **ShadcnUI**: UI 컴포넌트
- **React Query**: 서버 상태 관리
- **Zustand**: 클라이언트 상태 관리
- **React Hook Form**: 폼 관리
- **Zod**: 스키마 검증

### 데이터베이스
- **SQLite**: 개발 환경용 데이터베이스
- **PostgreSQL**: 프로덕션 환경용 데이터베이스

## 3. 시스템 아키텍처

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│  관리자 인터페이스  │────▶  API 서버      │────▶  데이터베이스    │
│  (Next.js)      │     │  (FastAPI)      │     │  (SQLite/PostgreSQL) │
│                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 포트 및 경로 구조

시스템은 포트 15022를 사용하여 일반 사용자와 관리자를 구분합니다:

- **일반 사용자 접근**: `http://localhost:15022/home` 또는 `http://서버주소:15026`
  - 일반 사용자들이 카페 메뉴를 탐색하고 주문하는 인터페이스
  - 챗봇을 통한 메뉴 추천 기능
  - 장바구니 및 주문 기능
  - `/home` 경로는 서버 주소:15026과 동일한 기능을 제공합니다.

- **관리자 접근**: `http://localhost:15022/admin`
  - 관리자 로그인 페이지
  - 인증 후 관리자 대시보드로 이동
  - 메뉴 관리, 주문 관리, 통계 등의 기능 제공

이 구조를 통해 일반 사용자와 관리자의 인터페이스를 명확히 구분하고, 각각의 역할에 맞는 기능을 제공합니다.

### 사용자와 관리자 페이지의 명확한 구분

일반 사용자와 관리자 페이지는 반드시 명확하게 구분되어야 합니다. 이는 다음과 같은 이유로 중요합니다:

1. **보안 강화**: 관리자 기능은 민감한 데이터와 시스템 설정에 접근할 수 있으므로, 일반 사용자와 분리하여 보안을 강화합니다.

2. **사용자 경험 최적화**: 각 사용자 유형에 맞는 인터페이스를 제공하여 사용자 경험을 최적화합니다.
   - 일반 사용자: 직관적이고 간단한 인터페이스, 메뉴 탐색과 주문에 초점
   - 관리자: 상세한 정보와 관리 기능에 초점, 데이터 분석과 시스템 관리 도구 제공

3. **권한 관리 용이성**: 각 페이지에 대한 접근 권한을 명확히 구분하여 관리할 수 있습니다.

4. **디자인 일관성**: 각 페이지 유형에 맞는 일관된 디자인을 적용할 수 있습니다.

5. **개발 및 유지보수 효율성**: 각 페이지 유형별로 독립적인 개발 및 유지보수가 가능합니다.

이러한 구분은 URL 구조(`/home`과 `/admin`)뿐만 아니라, 디자인, 기능, 접근 권한 등 모든 측면에서 일관되게 적용되어야 합니다.

## 4. 관리자 인증 및 접근 흐름

### 관리자 로그인 프로세스

1. **초기 접근**: 사용자가 `http://localhost:15022/admin`에 접근하면 즉시 관리자 로그인 화면이 표시됩니다.
   - 로그인 화면은 이메일과 비밀번호 입력 필드로 구성됩니다.
   - 로그인 화면에는 관리자 시스템임을 명확히 표시하는 로고와 제목이 포함됩니다.

2. **인증 처리**:
   - 사용자가 이메일과 비밀번호를 입력하고 로그인 버튼을 클릭합니다.
   - 백엔드 API(`POST /api/auth/admin/login`)로 인증 요청이 전송됩니다.
   - 백엔드는 사용자 정보를 확인하고 `is_admin` 필드가 `true`인지 검증합니다.
   - 인증 성공 시 JWT 토큰이 발급되어 클라이언트에 반환됩니다.

3. **인증 후 접근**:
   - 인증 성공 시 JWT 토큰이 로컬 스토리지에 저장됩니다.
   - 사용자는 자동으로 관리자 대시보드(`/admin/dashboard`)로 리디렉션됩니다.
   - 이후 모든 관리자 API 요청에는 JWT 토큰이 Authorization 헤더에 포함됩니다.

4. **인증 상태 유지**:
   - JWT 토큰은 1시간 동안 유효하며, 이후에는 리프레시 토큰을 사용하여 갱신할 수 있습니다.
   - 리프레시 토큰은 7일 동안 유효합니다.
   - 토큰이 만료되면 사용자는 다시 로그인해야 합니다.

### 관리자 권한 검증

1. **클라이언트 측 검증**:
   - 관리자 페이지에 접근할 때마다 JWT 토큰의 유효성을 확인합니다.
   - 토큰이 없거나 만료된 경우 로그인 페이지로 리디렉션합니다.

2. **서버 측 검증**:
   - 모든 관리자 API 엔드포인트는 JWT 토큰의 유효성을 검증합니다.
   - 토큰이 유효하지 않거나 관리자 권한이 없는 경우 401 또는 403 오류를 반환합니다.

### 관리자 로그아웃

1. **로그아웃 처리**:
   - 사용자가 로그아웃 버튼을 클릭하면 로컬 스토리지에서 JWT 토큰이 삭제됩니다.
   - 사용자는 로그인 페이지로 리디렉션됩니다.

## 5. API 엔드포인트

### 인증 관련
- `POST /api/auth/admin/register`: 관리자 등록
- `POST /api/auth/admin/login`: 관리자 로그인
- `POST /api/auth/admin/refresh`: 토큰 갱신
- `GET /api/auth/admin/me`: 현재 로그인한 관리자 정보

### 메뉴 관리
- `GET /api/admin/menus`: 메뉴 목록 조회
- `GET /api/admin/menus/{id}`: 메뉴 상세 조회
- `POST /api/admin/menus`: 메뉴 추가
- `PUT /api/admin/menus/{id}`: 메뉴 수정
- `DELETE /api/admin/menus/{id}`: 메뉴 삭제

### 주문 관리
- `GET /api/admin/orders`: 주문 목록 조회
- `GET /api/admin/orders/{id}`: 주문 상세 조회
- `PUT /api/admin/orders/{id}/status`: 주문 상태 변경

### 통계
- `GET /api/admin/statistics/daily`: 일별 매출 통계
- `GET /api/admin/statistics/monthly`: 월별 매출 통계
- `GET /api/admin/statistics/yearly`: 연간 매출 통계
- `GET /api/admin/statistics/popular`: 인기 메뉴 통계

## 6. 프론트엔드 페이지 구조

### 관리자 로그인
- `/admin`: 관리자 로그인 페이지
  - 이메일 및 비밀번호 입력 폼
  - 로그인 버튼
  - 오류 메시지 표시 영역

### 관리자 대시보드
- `/admin/dashboard`: 대시보드 메인 페이지
  - 일별 매출 그래프
  - 최근 주문 목록
  - 인기 메뉴 목록
  - 알림 및 경고
  - 사이드바 네비게이션 메뉴

### 메뉴 관리
- `/admin/menus`: 메뉴 목록 페이지
- `/admin/menus/new`: 메뉴 추가 페이지
- `/admin/menus/{id}`: 메뉴 상세/수정 페이지

### 주문 관리
- `/admin/orders`: 주문 목록 페이지
- `/admin/orders/{id}`: 주문 상세 페이지

### 통계
- `/admin/statistics`: 통계 페이지
  - 일별/월별/연간 매출 그래프
  - 인기 메뉴 차트
  - 시간대별 주문 분석

### 설정
- `/admin/settings`: 관리자 설정 페이지
  - 프로필 관리
  - 비밀번호 변경
  - 시스템 설정

## 7. 보안 설계

### 인증 및 권한 관리
- JWT 기반 인증 시스템
- 토큰 만료 시간: 1시간
- 리프레시 토큰 만료 시간: 7일
- 비밀번호 해싱: bcrypt 알고리즘

### API 보안
- CORS 설정
- Rate Limiting
- 입력 데이터 검증
- SQL 인젝션 방지

## 8. 구현 우선순위

1. 관리자 인증 시스템 구현
2. 메뉴 관리 기능 구현
3. 주문 관리 기능 구현
4. 통계 기능 구현
5. UI/UX 개선 및 최적화

## 9. 테스트 계획

### 백엔드 테스트
- 단위 테스트: 각 API 엔드포인트 및 비즈니스 로직
- 통합 테스트: API 서버와 데이터베이스 연동
- 인증 및 권한 테스트

### 프론트엔드 테스트
- 컴포넌트 테스트
- 페이지 테스트
- 사용자 인터랙션 테스트
- 반응형 디자인 테스트

## 10. 배포 계획

### 개발 환경
- 로컬 개발 서버
- SQLite 데이터베이스

### 스테이징 환경
- 테스트 서버
- PostgreSQL 데이터베이스

### 프로덕션 환경
- Linux 서버 (Ubuntu 22.04 LTS)
- Nginx 웹 서버
- Gunicorn 애플리케이션 서버
- PostgreSQL 데이터베이스
- SSL 인증서
- 백업 및 모니터링 시스템 